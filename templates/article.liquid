<script>
 $(function(){
    $(".comments").hide();
    var anchor = $(document).attr('location').hash;
    if (anchor == "#comments" || anchor == "#comment_form") $(".comments").show();
    $("#comments_link").click(function(e){
        e.preventDefault();
        $(".comments").toggle();
    });
 });
</script>

<h1>{{ article.title }}</h1>
<div class="clearfix" id="contentBody">
  {{ article.content }}
  <p><a href="/blog">Вернуться к списку записей</a></p>

  
  {% if blog.comments_enabled? %}
  <div id="comments">
    <h3><a name="comments" id="comments_link">Комментарии: {{article.comments_count}}</a></h3>
    <!-- List all comments -->
  
    {% if article.comments == empty %}
      <p class="box"><em>Пока нет комментариев</em></p>
    {% else %}
      <ul class="comments">
      {% for comment in article.comments %}
        <li>
          <div class="comment">
            {{ comment.content | newline_to_br }}
          </div>
        
        <div class="comment-details">
            Добавил(а) {{ comment.author }} , {{ comment.created_at | date: "%d.%m.%Y %H:%M" }}
          </div>
        </li>
      {% endfor %}
      </ul>
    {% endif %}
  </div>
  <div id="comment_form">
    <!-- Comment Form -->
    {% form comment %}
      <h3>Оставить комментарий</h3>
      
      {% if form.posted_successfully? %}
        {% if blog.moderated? %}
          <div class="notice">
            Комментарий успешно отправлен.<br />
            Он будет промодерирован владельцем блога перед публикацией.
          </div>
        {% else %}
          <div class="notice">Комментарий добавлен.</div>
        {% endif %}
      {% endif %}
  
      {% if comment.errors.size > 0 %}
        <div class="notice error">Не все поля заполнены правильно!</div>
      {% endif %}
  
  
      <dl id="author_fields">
          <dt class="{% if comment.errors contains 'author' %}error{% endif %}"><label for="comment_author">Имя</label></dt>
          <dd><input type="text" id="comment_author" name="comment[author]" value="{{comment.author}}" class="{% if comment.errors contains 'author' %}input-error{% endif %}" /></dd>
  
          <dt class="{% if comment.errors contains 'email' %}error{% endif %}"><label for="comment_email">E-mail</label></dt>
          <dd><input type="text" id="comment_email" name="comment[email]" value="{{comment.email}}" class="{% if comment.errors contains 'email' %}input-error{% endif %}" /></dd>
  {% if comment.captcha_enabled? %}
            <div id="captcha">
                <div id="captcha_challenge">
                    {{ comment | captcha_challenge }}
                </div>
                <input type="text" size="30" name="comment[captcha_solution]" id="comment_captcha_solution" class="textfield {% if comment.errors contains 'captcha_solution' %}input-error{% endif %}">
                <br/><small>Наберите текст, изображённый на картинке</small>
            </div>
        {% endif %}
          <p class="small">Все поля обязательны к заполнению</p>
          <input type="submit" value="Отправить комментарий" />
      </dl>
      <dl id="comment_fields">
          <dt class="{% if comment.errors contains 'content' %}error{% endif %}"><label for="comment_body">Комментарий</label></dt>
          <dd><textarea id="comment_body" name="comment[content]" cols="32" rows="4" class="{% if comment.errors contains 'content' %}input-error{% endif %}">{{comment.content}}</textarea></dd>
      </dl>
      
      {% if blog.moderated? %}
        <div id="moderation_warning">перед публикаций комментарии проходят модерацию</div>
      {% endif %}
    {% endform %}
  </div>
  {% endif %}
  
</div>